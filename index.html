<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<title>U本位合约计算器（专业版 UI）</title>

<style>
/* ===== 全局 ===== */
*{
  box-sizing:border-box;
  transition:0.22s ease;
}
body{
  margin:0; padding:32px;
  font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background:linear-gradient(135deg,#e9ecf7,#f7f9ff);
  color:#111;
}

/* 宽度控制 */
.wrap{
  max-width:1200px;
  margin:0 auto;
}

/* 标题 */
h1{
  margin:0 0 20px;
  font-size:26px;
  font-weight:700;
  letter-spacing:0.5px;
  color:#1a1a1a;
}

/* ===== 卡片（玻璃+阴影） ===== */
.card{
  background:rgba(255,255,255,0.75);
  padding:22px 24px;
  border-radius:18px;
  margin-bottom:26px;
  border:1px solid rgba(255,255,255,0.4);
  backdrop-filter:blur(16px) saturate(180%);
  -webkit-backdrop-filter:blur(16px) saturate(180%);
  box-shadow:0 8px 25px rgba(0,0,0,.07);
}
.card:hover{
  transform:translateY(-3px);
  box-shadow:0 12px 28px rgba(0,0,0,.12);
}

/* 小标题 */
h2{
  margin:0 0 16px;
  font-size:18px;
  font-weight:700;
  color:#222;
}

/* 输入与选择 */
label{
  font-size:13px;
  font-weight:600;
  margin-bottom:6px;
  display:block;
  color:#333;
}
input,select{
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid rgba(0,0,0,0.12);
  font-size:14px;
  background:rgba(255,255,255,0.55);
  outline:none;
}
input:focus,select:focus{
  border-color:#4d79ff;
  box-shadow:0 0 0 3px rgba(77,121,255,0.25);
}

/* ===== 网格 ===== */
.grid2{
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:16px;
  margin-bottom:10px;
}

/* ===== 按钮 ===== */
button{
  width:100%;
  padding:14px;
  margin-top:16px;
  background:linear-gradient(135deg,#4169ff,#2d47f7);
  border:none;
  border-radius:12px;
  color:white;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  letter-spacing:0.4px;
  box-shadow:0 4px 15px rgba(66,102,255,0.3);
}
button:hover{
  transform:translateY(-2px);
  box-shadow:0 6px 18px rgba(66,102,255,0.45);
}

/* ===== 结果显示 ===== */
.result-block{
  margin-top:14px;
  padding:18px;
  border-radius:14px;
  background:rgba(243,246,255,0.65);
  border:1px solid rgba(200,205,255,0.55);
  font-size:14px;
  box-shadow:0 4px 18px rgba(0,0,0,0.05);
}
.row{
  display:flex;
  justify-content:space-between;
  margin-bottom:8px;
}
.row span:first-child{color:#4a4f61;}
.row.big span:last-child{font-size:17px; font-weight:700; color:#223;}
</style>
</head>

<body>
<div class="wrap">

<h1>U本位合约计算器（专业美化版）</h1>

<!-- 参数输入卡片 -->
<div class="card">
  <h2>基础参数</h2>

  <div class="grid2">
    <div>
      <label>方向</label>
      <select id="side">
        <option value="long">做多</option>
        <option value="short">做空</option>
      </select>
    </div>

    <div>
      <label>面值</label>
      <input id="faceValue" type="text" inputmode="decimal" />
    </div>

    <div>
      <label>开仓均价</label>
      <input id="openPx" type="text" inputmode="decimal" />
    </div>

    <div>
      <label>平仓均价</label>
      <input id="closePx" type="text" inputmode="decimal" />
    </div>

    <div>
      <label>张数</label>
      <input id="contracts" type="text" inputmode="decimal" />
    </div>

    <div>
      <label>杠杆倍数</label>
      <input id="leverage" type="text" inputmode="decimal" />
    </div>
  </div>

  <h2>手续费（% 输入，可为负）</h2>

  <div class="grid2">
    <div>
      <label>Maker（%）</label>
      <input id="makerFee" type="text" inputmode="decimal" placeholder="例如 -0.02" />
    </div>

    <div>
      <label>Taker（%）</label>
      <input id="takerFee" type="text" inputmode="decimal" placeholder="例如 0.05" />
    </div>

    <div>
      <label>开仓使用</label>
      <select id="openRole">
        <option value="maker">Maker</option>
        <option value="taker">Taker</option>
      </select>
    </div>

    <div>
      <label>平仓使用</label>
      <select id="closeRole">
        <option value="maker">Maker</option>
        <option value="taker">Taker</option>
      </select>
    </div>
  </div>

  <h2>风险参数</h2>

  <div class="grid2">
    <div>
      <label>标记价格</label>
      <input id="markPx" type="text" inputmode="decimal" />
    </div>

    <div>
      <label>资金费率（%）</label>
      <input id="fundingRate" type="text" inputmode="decimal" />
    </div>

    <div>
      <label>维持保证金率（%）</label>
      <input id="mmRate" type="text" inputmode="decimal" />
    </div>

    <div>
      <label>强平手续费率（%）</label>
      <input id="liqFeeRate" type="text" inputmode="decimal" />
    </div>

    <div>
      <label>保证金余额</label>
      <input id="marginBalance" type="text" inputmode="decimal" />
    </div>
  </div>

  <button onclick="calcU()">计算（Excel 1:1 完整实现）</button>
</div>

<!-- 输出卡片 -->
<div class="card">
  <h2>计算结果</h2>
  <div id="result" class="result-block">请填写参数并点击计算。</div>
</div>

</div>


<script>
// 获取数字
function num(id){
  let v = document.getElementById(id).value.trim();
  if(!v) return null;
  v = v.replace(/,/g,'').replace(/，/g,'');
  return parseFloat(v);
}

function pct(v){ return v / 100; }

// 主要计算函数
function calcU(){
  const side = document.getElementById("side").value;
  const face = num("faceValue");
  const open = num("openPx");
  const close = num("closePx");
  const ctt = num("contracts");
  const lev  = num("leverage");

  const makerPct = num("makerFee");
  const takerPct = num("takerFee");
  const openRole  = document.getElementById("openRole").value;
  const closeRole = document.getElementById("closeRole").value;

  const mark = num("markPx");
  const fundPct = num("fundingRate");
  const mmPct   = num("mmRate");
  const liqPct  = num("liqFeeRate");
  const mb      = num("marginBalance");

  const result = document.getElementById("result");

  if([face,open,close,ctt,lev].some(v => v===null)){
    result.innerHTML = "请先输入主要参数再计算。";
    return;
  }

  const absC = Math.abs(ctt);

  const maker = pct(makerPct || 0);
  const taker = pct(takerPct || 0);

  const feeOpenRate  = openRole==="maker" ? maker : taker;
  const feeCloseRate = closeRole==="maker" ? maker : taker;

  // Excel：开仓保证金
  const margin = face * absC * open / lev;

  // Excel：未扣手续费收益
  let pnl = side==="long"
    ? face * absC * (close - open)
    : face * absC * (open - close);

  // Excel：手续费
  const feeOpen  = face * absC * open  * feeOpenRate;
  const feeClose = face * absC * close * feeCloseRate;
  const feeTotal = feeOpen + feeClose;

  // Excel：最后收益
  const net = pnl - feeTotal;
  const roe = margin !== 0 ? net / margin * 100 : 0;

  let html = "";
  html += row("开仓保证金", margin.toFixed(8));
  html += row("开仓手续费", feeOpen.toFixed(8));
  html += row("平仓手续费", feeClose.toFixed(8));
  html += row("总手续费", feeTotal.toFixed(8));
  html += row("收益（未扣手续费）", pnl.toFixed(8));
  html += rowBig("最终收益（含手续费）", net.toFixed(8));
  html += row("收益率 ROE", roe.toFixed(4)+" %");

  // 仓位价值 + 资金费用
  let posValue = null, fundingFee = null;
  if(mark !== null){
    posValue = face * absC * mark;
    html += row("仓位价值", posValue.toFixed(8));

    if(fundPct !== null){
      fundingFee = posValue * pct(fundPct);
      html += row("资金费用", fundingFee.toFixed(8));
    }
  }

  // 维持保证金
  if(mark!==null && mmPct!==null){
    const maint = face * absC * mark * pct(mmPct);
    html += row("维持保证金", maint.toFixed(8));
  }

  // 强平价
  if(mb!==null && liqPct!==null){
    const mm = pct(mmPct||0);
    const lf = pct(liqPct||0);
    const pos = face * absC;

    // 多仓
    const denomLong = pos*(mm + lf - 1);
    if(denomLong!==0){
      const L = (mb - pos*open) / denomLong;
      html += row("多仓强平价", L.toFixed(8));
    }

    // 空仓
    const denomShort = pos*(mm + lf + 1);
    if(denomShort!==0){
      const S = (mb + pos*open) / denomShort;
      html += row("空仓强平价", S.toFixed(8));
    }
  }

  result.innerHTML = html;
}

function row(a,b){
  return `<div class="row"><span>${a}</span><span>${b}</span></div>`;
}
function rowBig(a,b){
  return `<div class="row big"><span>${a}</span><span>${b}</span></div>`;
}
</script>

</body>
</html>
